var express = require('express');
var router = express.Router();
const nodemailer = require('nodemailer');

let transporter = nodemailer.createTransport({
  service: 'Gmail',
  auth: {
    user: process.env.USER,
    pass: process.env.PASS
  }
});

// setup email data with unicode symbols
let mailOptions = {
    from: '"Fred Foo üëª" <foo@blurdybloop.com>', // sender address
    to: 'pride.ots@gmail.com', // list of receivers
    subject: 'Hello ‚úî', // Subject line
    text: 'Hello world ?', // plain text body
    html: '<b>Hello world ?</b>' // html body
};

/* GET home page. */
router.get('/', function(req, res, next) {
  res.locals.msg = {
    display: false,
    msg: '',
    class: ''
  };
  res.render('index', {
    title: 'Express',
    city: [
      '–°–æ–ª–∏–∫–∞–º—Å–∫',
      '–ë–µ—Ä–µ–∑–Ω–∏–∫–∏',
      '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤—Å–∫',
      '–Ø–π–≤–∞',
      '–ö–∏–∑–µ–ª',
      '–ì—É–±–∞—Ö–∞',
      '–£—Å–æ–ª—å–µ',
      '–ö—Ä–∞—Å–Ω–æ–≤–∏—à–µ—Ä—Å–∫',
      '–ß–µ—Ä–¥—ã–Ω—å',
      '–ù—ã—Ä–æ–±',
      '–ü–µ—Ä–º—å',
      '–î–æ–±—Ä—è–Ω–∫–∞',
      '–ö—Ä–∞—Å–Ω–æ–∫–∞–º—Å–∫',
      '–ß—É—Å–æ–≤–æ–π',
      '–õ—ã—Å—å–≤–∞',
      '–ì–æ—Ä–Ω–æ–∑–∞–≤–æ–¥—Å–∫',
      '–ö—É–Ω–≥—É—Ä',
      '–û—Å–∞',
      '–ß–µ—Ä–Ω—É—à–∫–∞',
      '–ö—É–¥—ã–º–∫–∞—Ä',
      '–ù—ã—Ç–≤–∞',
      '–ß–∞–π–∫–æ–≤—Å–∫–∏–π',
      '*–¥—Ä—É–≥–æ–π'
    ],
    prof: [
      '–ú–∞—à–∏–Ω–∏—Å—Ç –ø–æ–¥—ä–µ–º–Ω—ã—Ö –º–∞—à–∏–Ω',
      '–ê–ø–ø–∞—Ä–∞—Ç—á–∏–∫ —Å–æ—Å—É–¥–æ–≤, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –ø–æ–¥ –¥–∞–≤–ª–µ–Ω–∏–µ–º',
      '–ö—Ä–∞–Ω–æ–≤—â–∏–∫–∏ –º–æ—Å—Ç–æ–≤—ã—Ö, –∫–æ–∑–ª–æ–≤—ã—Ö, –±–∞—à–µ–Ω–Ω—ã—Ö, —Å—Ç—Ä–µ–ª–æ–≤—ã—Ö —Å–∞–º–æ—Ö–æ–¥–Ω—ã—Ö, –∫—Ä–∞–Ω–æ–≤-–º–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä–æ–≤, –∞–≤—Ç–æ–º–æ–±–∏–ª—å–Ω—ã—Ö, –ø–ª–∞–≤. –∫—Ä–∞–Ω–æ–≤',
      '–ü–µ—Å–∫–æ—Å—Ç—Ä—É–π—â–∏–∫',
      '–ú–∞–ª—è—Ä',
      '–°—Ç–≤–æ–ª–æ–≤–æ–π',
      '–õ–∞–±–æ—Ä–∞–Ω—Ç —Ö–∏–º–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞',
      '–õ–∏—Ñ—Ç—ë—Ä',
      '–ú–∞—à–∏–Ω–∏—Å—Ç –ª–µ–±—ë–¥–æ–∫',
      '–ú–∞—à–∏–Ω–∏—Å—Ç –∫–æ–º–ø—Ä–µ—Å—Å–æ—Ä–Ω—ã—Ö —É—Å—Ç–∞–Ω–æ–≤–æ–∫',
      '–û–ø–µ—Ä–∞—Ç–æ—Ä –∫–æ—Ç–µ–ª—å–Ω–æ–π, –¢–ú–£',
      '–ü–µ—Ä—Å–æ–Ω–∞–ª, –æ–±—Å–ª—É–∂–∏–≤–∞—é—â–∏–π —Å–æ—Å—É–¥—ã, —Ä–∞–±–æ—Ç–∞—é—â–∏–µ –ø–æ–¥ –¥–∞–≤–ª–µ–Ω–∏–µ–º',
      '–ü–µ—Ä—Å–æ–Ω–∞–ª, –æ–±—Å–ª—É–∂–∏–≤–∞—é—â–∏–π –≥–∞–∑–æ–ø–æ—Ç—Ä–µ–±–ª—è—é—â–µ–µ –∏ –≥–∞–∑–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—â–µ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ',
      '–ü–µ—Ä—Å–æ–Ω–∞–ª –ø–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—é, —Ä–µ–º–æ–Ω—Ç—É –∏ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ –¢–≠–£',
      '–†–∞–±–æ—á–∏–π –ª—é–ª–µ–∫ –ø–æ–¥—ä—ë–º–Ω–∏–∫–æ–≤ (–≤—ã—à–µ–∫)/—Ñ–∞—Å–∞–¥–Ω—ã—Ö –ø–æ–¥—ä—ë–º–Ω–∏–∫–æ–≤',
      '–†–µ–∑—á–∏–∫ –Ω–∞ —Å–∂–∏–∂–µ–Ω–Ω–æ–º –≥–∞–∑–µ –ø—Ä–æ–ø–∞–Ω-–±—É—Ç–∞–Ω–µ',
      '–°—Ç—Ä–æ–ø–∞–ª—å—â–∏–∫ –ü–°',
      '–°—Ç—Ä–æ–ø–∞–ª—å—â–∏–∫ —Å –ø—Ä–∞–≤–æ–º —Ä–∞–±–æ—Ç—ã —Å –ü–°, —É–ø—Ä–∞–≤–ª—è–µ–º—ã—Ö —Å –ø–æ–ª–∞',
      '–°–ª–µ—Å–∞—Ä—å-—Ä–µ–º–æ–Ω—Ç–Ω–∏–∫ –ø–æ —Ä–µ–º–æ–Ω—Ç—É –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—é –ü–°',
      '–°–ª–µ—Å–∞—Ä—å –ø–æ —Ä–µ–º–æ–Ω—Ç—É –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è —Ç–æ–ø–ª–∏–≤–æ–ø–æ–¥–∞—á–∏',
      '–°–ª–µ—Å–∞—Ä—å –ø–æ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ –∏ —Ä–µ–º–æ–Ω—Ç—É –≥–∞–∑–æ–≤–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è',
      '–°–ª–∏–≤—â–∏–∫-–∑–∞–ª–∏–≤—â–∏–∫ –ì–°–ú (–≥–æ—Ä—é—á–µ—Å–º–∞–∑–æ—á–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤)',
      '–≠–ª–µ–∫—Ç—Ä–æ–º–æ–Ω—Ç—ë—Ä –ø–æ —Ä–µ–º–æ–Ω—Ç—É –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—é –ü–°'
    ]
  });
});

router.post('/', function(req, res){
  transporter.sendMail(mailOptions, (error, info) => {
    if (error) {
        console.log(error);
        req.flash('error', '–í–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞, —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–ø—ã—Ç–∫—É –ø–æ–∑–∂–µ.');
        return res.redirect('/');
    }
    console.log('Message %s sent: %s', info.messageId, info.response);
    req.flash('success', '–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ.');
    res.redirect('/');
  });
});

module.exports = router;